<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aulas</title>
</head>
<body>
 <!-- Alunos Abaixo da Frequência (Mantido) -->
<div class="mb-8 p-4 bg-red-100 rounded-lg shadow">
    <h2 class="text-xl font-semibold text-red-800 border-b-red-300">Lista de Alunos Abaixo da Frequência (75%)</h2>
    <ul class="list-disc list-inside space-y-1">
        {% for aluno in alunos %}
            {% if aluno.alu_frequencia < 75 %}
                <li class="text-red-700 font-medium">{{ aluno.alu_nome }} - Frequência: {{ aluno.alu_frequencia | round(1) }}%</li>
            {% endif %}
        {% endfor %}
    </ul>
</div>

<!-- SEÇÃO DE CADASTROS -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
    <!-- Cadastro de alunos -->
    <div class="p-4 bg-white rounded-lg shadow border border-gray-200">
        <h3 class="text-lg font-bold mb-3 text-indigo-700">Cadastrar Aluno</h3>
        <form action="/create_aluno" method="POST" class="space-y-3">
            <input type="text" name="nome_aluno" placeholder="Nome do Aluno" required class="w-full p-2 border rounded-md">
            <input type="number" step="0.1" name="frequencia" placeholder="Frequência (%)" required min="0" max="100" class="w-full p-2 border rounded-md">
            <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition">Cadastrar</button>
        </form>
    </div>

    <!-- Cadastro de disciplinas -->
    <div class="p-4 bg-white rounded-lg shadow border border-gray-200">
        <h3 class="text-lg font-bold mb-3 text-indigo-700">Cadastrar Disciplina</h3>
        <form action="/create_disciplina" method="POST" class="space-y-3">
            <input type="text" name="nome_disciplina" placeholder="Nome da Disciplina" required class="w-full p-2 border rounded-md">
            <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition">Cadastrar</button>
        </form>
    </div>

    <!-- Cadastro de notas -->
    <div class="p-4 bg-white rounded-lg shadow border border-gray-200">
        <h3 class="text-lg font-bold mb-3 text-indigo-700">Registrar Nota</h3>
        <form action="/create_nota" method="POST" class="space-y-3">
            <select name="aluno_id" required class="w-full p-2 border rounded-md">
                <option value="">Selecione o Aluno</option>
                {% for aluno in alunos %}
                    <option value="{{ aluno.alu_id }}">{{ aluno.alu_nome }}</option>
                {% endfor %}
            </select>
            <select name="disciplina_id" required class="w-full p-2 border rounded-md">
                <option value="">Selecione a Disciplina</option>
                {% for disciplina in disciplinas %}
                    <option value="{{ disciplina.dis_id }}">{{ disciplina.dis_nome }}</option>
                {% endfor %}
            </select>
            <input type="number" step="0.1" name="nota_valor" placeholder="Valor da Nota (0.0 - 10.0)" required min="0" class="w-full p-2 border rounded-md">
            <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition">Registrar</button>
        </form>
    </div>
</div>


<!-- 1. TABELA DE ALUNOS -->
<h2>Listagem e Ações dos Alunos</h2>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Frequência (%)</th>
            <th class="w-40">Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for aluno in alunos %}
        <tr>
            <td>{{ aluno.alu_id }}</td>
            <form action="{{ url_for('update_entidade', entidade_nome='aluno', entidade_id=aluno.alu_id) }}" method="POST">
                <td><input type="text" name="nome" value="{{ aluno.alu_nome }}" required class="p-1 border rounded-md w-full"></td>
                <td><input type="number" step="0.1" name="frequencia" value="{{ aluno.alu_frequencia }}" required min="0" max="100" class="p-1 border rounded-md w-24 text-center"></td>
                <td class="flex space-x-2">
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-md text-xs hover:bg-green-600">Atualizar</button>
            </form>
                    <!-- Assumindo que você tem uma rota delete_entidade -->
                    <form action="{{ url_for('delete_entidade', entidade_nome='aluno', entidade_id=aluno.alu_id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja deletar o aluno {{ aluno.alu_nome }}?');">
                        <button type="submit" class="bg-red-500 text-white p-2 rounded-md text-xs hover:bg-red-600">Deletar</button>
                    </form>
                </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 2. TABELA DE DISCIPLINAS -->
<h2 class="mt-8">Listagem e Ações das Disciplinas</h2>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th class="w-40">Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for disciplina in disciplinas %}
        <tr>
            <td>{{ disciplina.dis_id }}</td>
            <form action="{{ url_for('update_entidade', entidade_nome='disciplina', entidade_id=disciplina.dis_id) }}" method="POST">
                <td><input type="text" name="nome_disciplina" value="{{ disciplina.dis_nome }}" required class="p-1 border rounded-md w-full"></td>
                <td class="flex space-x-2">
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-md text-xs hover:bg-green-600">Atualizar</button>
            </form>
                    <!-- Assumindo que você tem uma rota delete_entidade -->
                    <form action="{{ url_for('delete_entidade', entidade_nome='disciplina', entidade_id=disciplina.dis_id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja deletar a disciplina {{ disciplina.dis_nome }}?');">
                        <button type="submit" class="bg-red-500 text-white p-2 rounded-md text-xs hover:bg-red-600">Deletar</button>
                    </form>
                </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 3. TABELA DE NOTAS -->
<h2 class="mt-8">Listagem e Ações das Notas</h2>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Aluno</th>
            <th>Disciplina</th>
            <th>Nota</th>
            <th class="w-40">Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for nota in notas %}
        <tr>
            <td>{{ nota.not_id }}</td>
            <td>{{ nota.aluno.alu_nome }}</td>
            <td>{{ nota.disciplina.dis_nome }}</td>
            <form action="{{ url_for('update_entidade', entidade_nome='nota', entidade_id=nota.not_id) }}" method="POST">
                <td><input type="number" step="0.1" name="novo_valor_nota" value="{{ nota.not_valor }}" required min="0" class="p-1 border rounded-md w-16 text-center"></td>
                <td class="flex space-x-2">
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-md text-xs hover:bg-green-600">Atualizar</button>
            </form>
                    <!-- Assumindo que você tem uma rota delete_entidade -->
                    <form action="{{ url_for('delete_entidade', entidade_nome='nota', entidade_id=nota.not_id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja deletar esta nota?');">
                        <button type="submit" class="bg-red-500 text-white p-2 rounded-md text-xs hover:bg-red-600">Deletar</button>
                    </form>
                </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr class="my-10">

<!-- 4. MÉDIAS POR DISCIPLINA (Mantido) -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div>
        {% if medias_disciplinas %}
            <table class="shadow-md">
                <h2>Médias por Disciplina</h2>
                    <tr class="bg-indigo-700">
                        <th style="padding: 10px; color: white;">Disciplina</th>
                        <th style="padding: 10px; color: white; text-align: right;">Média das Notas</th>
                    </tr>
                    {% for media in medias_disciplinas %}
                    <tr>
                        <td style="padding: 8px;">{{ media.dis_nome }}</td>
                        <td style="padding: 8px; text-align: right; font-weight: bold;">
                            {{ media.media_nota | round(2) }}
                        </td>
                    </tr>
                    {% endfor %}
            </table>
        {% else %}
            <p class="text-gray-500">Nenhuma nota registrada para calcular as médias.</p>
        {% endif %}
    </div>

    <!-- 5. ALUNOS ACIMA DA MÉDIA EM TUDO (Lógica Filtrada no Python) -->
    <div>
        <h2 class="text-green-700">Alunos Acima da Média</h2>
        <ul class="list-disc list-inside space-y-3 bg-green-50 p-4 rounded-lg border border-green-200">
            {% if alunos_acima_de_todas_medias %}
                {% for aluno_info in alunos_acima_de_todas_medias %}
                    <li class="font-bold text-green-800">
                        {{ aluno_info.nome }}
                    </li>
                {% endfor %}
            {% else %}
                <li class="text-gray-600">Nenhum aluno satisfaz este critério estrito.</li>
            {% endif %}
        </ul>
    </div>
</div>
</form>
</body>
</html>